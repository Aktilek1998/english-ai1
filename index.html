<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnglishAI - –ê“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ–Ω “Ø–π—Ä–µ—Ç–µ—Ç—ñ–Ω AI –±–æ—Ç</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4bb543;
            --warning: #ffcc00;
            --danger: #dc3545;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            display: flex;
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        }

        .sidebar {
            width: 300px;
            background: var(--secondary);
            color: white;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: var(--accent);
        }

        .logo p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .user-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .nav-menu {
            list-style: none;
            margin-top: 20px;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--primary);
        }

        .nav-link i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--light);
            overflow: hidden;
        }

        .chat-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .chat-bot-info {
            display: flex;
            align-items: center;
        }

        .bot-avatar {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
            color: white;
        }

        .bot-status {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: var(--success);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            margin-right: 5px;
        }

        .content-section {
            display: none;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        #chat {
            display: flex;
        }

        .chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .message {
            max-width: 70%;
            padding: 15px;
            border-radius: 18px;
            position: relative;
            animation: fadeIn 0.3s ease;
            word-wrap: break-word;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot-message {
            align-self: flex-start;
            background: white;
            border-bottom-left-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }

        .user-message {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #eaeaea;
            flex-shrink: 0;
        }

        .input-group {
            display: flex;
            background: var(--light);
            border-radius: 25px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            outline: none;
            font-size: 1rem;
        }

        .send-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-btn:hover {
            background: var(--secondary);
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .quick-btn {
            background: var(--light);
            border: 1px solid #e0e0e0;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-btn:hover {
            background: var(--primary);
            color: white;
        }

        .quick-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            margin-bottom: 20px;
        }

        .typing-dots {
            display: flex;
            background: white;
            padding: 15px;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }

        .typing-dots span {
            height: 10px;
            width: 10px;
            background: #ccc;
            border-radius: 50%;
            display: block;
            margin: 0 2px;
            animation: typing 1s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .suggestion {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .suggestion:hover {
            background: var(--primary);
            color: white;
        }

        .suggestion:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .api-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .api-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .api-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .api-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }

        .api-btn:hover {
            background: var(--secondary);
        }

        .api-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .test-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .test-btn:hover {
            background: #3a9bc8;
        }

        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
            font-family: monospace;
            max-height: 150px;
            overflow-y: auto;
        }

        .rate-limit-warning {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid #ff9800;
            color: #e65100;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.9rem;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4caf50;
            color: #2e7d32;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid #f44336;
            color: #c62828;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <h1>EnglishAI</h1>
                <p>–ê“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ–Ω “Ø–π—Ä–µ—Ç–µ—Ç—ñ–Ω AI –±–æ—Ç</p>
            </div>
            
            <div class="user-info">
                <h3>“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑, –û“õ—É—à—ã!</h3>
                <div class="user-stats">
                    <div class="stat">
                        <div class="stat-value">5</div>
                        <div class="stat-label">–î–µ“£–≥–µ–π</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">1,250</div>
                        <div class="stat-label">XP</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">12</div>
                        <div class="stat-label">–ö“Ø–Ω</div>
                    </div>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-tab="chat">
                        <i class="fas fa-robot"></i> AI –ë–æ—Ç–ø–µ–Ω –°”©–π–ª–µ—Å—É
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="reading">
                        <i class="fas fa-book-open"></i> –û“õ—É –î–∞“ì–¥—ã–ª–∞—Ä—ã
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="listening">
                        <i class="fas fa-headphones"></i> –¢—ã“£–¥–∞—É –î–∞“ì–¥—ã–ª–∞—Ä—ã
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="grammar">
                        <i class="fas fa-pencil-alt"></i> –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="achievements">
                        <i class="fas fa-trophy"></i> –ñ–µ—Ç—ñ—Å—Ç—ñ–∫—Ç–µ—Ä
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="main-content">
            <div class="content-section" id="chat">
                <div class="chat-header">
                    <div class="chat-bot-info">
                        <div class="bot-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <h3>EnglishAI –ë–æ—Ç</h3>
                            <div class="bot-status">
                                <div class="status-dot"></div>
                                <span id="bot-status-text">API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑</span>
                            </div>
                        </div>
                    </div>
                    <button class="api-btn" onclick="showAPIKeyModal()" style="padding: 8px 15px; font-size: 14px;">
                        <i class="fas fa-key"></i> API –ö—ñ–ª—Ç
                    </button>
                </div>
                
                <div class="chat-container" id="chat-messages">
                    <div class="message bot-message">
                        <p>–°”ô–ª–µ–º–µ—Ç—Å—ñ–∑ –±–µ! üëã –ú–µ–Ω EnglishAI –±–æ—Ç—ã–º—ã–Ω - –∞“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ–Ω “Ø–π—Ä–µ—Ç–µ—Ç—ñ–Ω –∂–∞—Å–∞–Ω–¥—ã –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç.</p>
                        <p>–ñ“±–º—ã—Å —ñ—Å—Ç–µ—É “Ø—à—ñ–Ω –∞–ª–¥—ã–º–µ–Ω OpenAI API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.</p>
                        
                        <div class="rate-limit-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>API –ö—ñ–ª—Ç—ñ–Ω –ê–ª—É:</strong> 
                            <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #e65100; text-decoration: underline;">
                                platform.openai.com/api-keys
                            </a>
                        </div>

                        <div class="suggestions">
                            <div class="suggestion" onclick="showAPIKeyModal()">
                                <i class="fas fa-key"></i> API –ö—ñ–ª—Ç—ñ–Ω –ï–Ω–≥—ñ–∑—É
                            </div>
                            <div class="suggestion" onclick="testConnection()">
                                <i class="fas fa-plug"></i> –ë–∞–π–ª–∞–Ω—ã—Å—Ç—ã –¢–µ—Å—Ç—ñ–ª–µ—É
                            </div>
                        </div>
                        <div class="message-time">“ö–∞–∑—ñ—Ä</div>
                    </div>
                </div>
                
                <div class="typing-indicator" id="typing-indicator">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="input-group">
                        <input type="text" class="chat-input" id="user-input" placeholder="–ê–ª–¥—ã–º–µ–Ω API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑..." disabled>
                        <button class="send-btn" id="send-btn" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="quick-actions">
                        <div class="quick-btn" data-message="–°”ô–ª–µ–º–µ—Ç—Å—ñ–∑ –±–µ!">–°”ô–ª–µ–º–µ—Ç—Å—ñ–∑ –±–µ!</div>
                        <div class="quick-btn" data-message="“ö–∞–ª–∞–π—Å—ã–∑?">“ö–∞–ª–∞–π—Å—ã–∑?</div>
                        <div class="quick-btn" data-message="–ê“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ–Ω–¥–µ “õ–∞–ª–∞–π —Å”ô–ª–µ–º–¥–µ—Å—É–≥–µ –±–æ–ª–∞–¥—ã?">–°”ô–ª–µ–º–¥–µ—Å—É</div>
                        <div class="quick-btn" data-message="–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞“ì–∞ –∫”©–º–µ–∫ –∫–µ—Ä–µ–∫">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</div>
                    </div>
                </div>
            </div>
            
            <!-- –ë–∞—Å“õ–∞ –±”©–ª—ñ–º–¥–µ—Ä -->
            <div class="content-section" id="reading" style="display: none;">
                <div class="chat-header"><h2>–û“õ—É –î–∞“ì–¥—ã–ª–∞—Ä—ã</h2></div>
                <div style="padding: 20px; text-align: center;"><h3>–ë“±–ª –±”©–ª—ñ–º ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ...</h3></div>
            </div>
            
            <div class="content-section" id="listening" style="display: none;">
                <div class="chat-header"><h2>–¢—ã“£–¥–∞—É –î–∞“ì–¥—ã–ª–∞—Ä—ã</h2></div>
                <div style="padding: 20px; text-align: center;"><h3>–ë“±–ª –±”©–ª—ñ–º ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ...</h3></div>
            </div>
            
            <div class="content-section" id="grammar" style="display: none;">
                <div class="chat-header"><h2>–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</h2></div>
                <div style="padding: 20px; text-align: center;"><h3>–ë“±–ª –±”©–ª—ñ–º ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ...</h3></div>
            </div>
            
            <div class="content-section" id="achievements" style="display: none;">
                <div class="chat-header"><h2>–ñ–µ—Ç—ñ—Å—Ç—ñ–∫—Ç–µ—Ä</h2></div>
                <div style="padding: 20px; text-align: center;"><h3>–ë“±–ª –±”©–ª—ñ–º ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ...</h3></div>
            </div>
        </div>
    </div>

    <!-- API –ö—ñ–ª—Ç –ú–æ–¥–∞–ª—å–¥—ã –¢–µ—Ä–µ–∑–µ—Å—ñ -->
    <div id="api-modal" class="api-modal" style="display: none;">
        <div class="api-modal-content">
            <h3><i class="fas fa-key"></i> OpenAI API –ö—ñ–ª—Ç—ñ–Ω –ï–Ω–≥—ñ–∑—É</h3>
            
            <div class="success-message" id="success-message" style="display: none;">
                <i class="fas fa-check-circle"></i> <span id="success-text"></span>
            </div>
            
            <div class="error-message" id="error-message" style="display: none;">
                <i class="fas fa-exclamation-circle"></i> <span id="error-text"></span>
            </div>
            
            <p><strong>1. API –∫—ñ–ª—Ç—ñ–Ω –∞–ª—ã“£—ã–∑:</strong></p>
            <p style="font-size: 14px; margin: 5px 0;">
                ‚Ä¢ <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com/api-keys</a> —Å–∞–π—Ç—ã–Ω–∞ ”©—Ç—ñ“£—ñ–∑<br>
                ‚Ä¢ –¢—ñ—Ä–∫–µ–ª—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ –∫—ñ—Ä—ñ“£—ñ–∑<br>
                ‚Ä¢ "Create new secret key" –±–∞—Å—ã“£—ã–∑<br>
                ‚Ä¢ –ö—ñ–ª—Ç—Ç—ñ –∫”©—à—ñ—Ä—ñ“£—ñ–∑
            </p>
            
            <p><strong>2. –ö—ñ–ª—Ç—Ç—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑:</strong></p>
            <input type="text" id="api-key-input" class="api-input" placeholder="sk-... (51 —Å–∏–º–≤–æ–ª)">
            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                –ö—ñ–ª—Ç "sk-" –¥–µ–ø –±–∞—Å—Ç–∞–ª—ã–ø, —à–∞–º–∞–º–µ–Ω 51 —Å–∏–º–≤–æ–ª –±–æ–ª—É—ã –∫–µ—Ä–µ–∫
            </div>
            
            <div style="margin-top: 20px;">
                <button class="api-btn" onclick="saveAndTestAPIKey()" id="save-test-btn">
                    <i class="fas fa-check"></i> –°–∞“õ—Ç–∞—É –∂”ô–Ω–µ –¢–µ—Å—Ç—ñ–ª–µ—É
                </button>
                <button class="test-btn" onclick="testCurrentKey()">
                    <i class="fas fa-plug"></i> –ê“ì—ã–º–¥–∞“ì—ã –∫—ñ–ª—Ç—Ç—ñ —Ç–µ—Å—Ç—ñ–ª–µ—É
                </button>
                <button class="api-btn" onclick="hideAPIKeyModal()" style="background: #6c757d;">
                    <i class="fas fa-times"></i> –ñ–∞–±—É
                </button>
            </div>
            
            <div id="debug-section" style="display: none; margin-top: 15px;">
                <h4>–¢–µ—Ö–Ω–∏–∫–∞–ª—ã“õ –∞“õ–ø–∞—Ä–∞—Ç:</h4>
                <div class="debug-info" id="debug-info"></div>
            </div>
            
            <div id="api-status" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
        </div>
    </div>

    <script>
        // API –∫—ñ–ª—Ç—ñ–Ω —Å–∞“õ—Ç–∞—É
        let OPENAI_API_KEY = localStorage.getItem('englishAI_openai_key') || '';
        let lastAPICallTime = 0;
        const MIN_TIME_BETWEEN_CALLS = 2000;

        // –ë–∞—Å—Ç–∞–ø“õ—ã –∂“Ø–∫—Ç–µ—É
        document.addEventListener('DOMContentLoaded', function() {
            updateAPIStatus();
            if (OPENAI_API_KEY) {
                enableInputs();
                testConnection(true); // –ê–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç–µ—Å—Ç
            } else {
                disableInputs();
            }
            scrollToBottom();
        });

        // –ë–µ—Ç—Ç–µ—Ä –∞—Ä–∞—Å—ã–Ω–¥–∞ –∞—É—ã—Å—É
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                document.querySelectorAll('.nav-link').forEach(item => {
                    item.classList.remove('active');
                });
                
                this.classList.add('active');
                
                document.querySelectorAll('.content-section').forEach(section => {
                    section.style.display = 'none';
                });
                
                const tabId = this.getAttribute('data-tab');
                const section = document.getElementById(tabId);
                section.style.display = 'flex';
                
                if (tabId === 'chat') {
                    setTimeout(() => {
                        scrollToBottom();
                    }, 100);
                }
            });
        });

        // –ß–∞—Ç —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä—ñ
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const botStatusText = document.getElementById('bot-status-text');

        // API –∫—ñ–ª—Ç –º–æ–¥–∞–ª—å–¥—ã —Ç–µ—Ä–µ–∑–µ—Å—ñ–Ω –±–∞—Å“õ–∞—Ä—É
        function showAPIKeyModal() {
            document.getElementById('api-modal').style.display = 'flex';
            document.getElementById('api-key-input').value = OPENAI_API_KEY;
            document.getElementById('debug-section').style.display = 'none';
            hideMessages();
            updateAPIStatus();
        }

        function hideAPIKeyModal() {
            document.getElementById('api-modal').style.display = 'none';
        }

        function hideMessages() {
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
        }

        function showSuccess(message) {
            const element = document.getElementById('success-message');
            document.getElementById('success-text').textContent = message;
            element.style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
        }

        function showError(message) {
            const element = document.getElementById('error-message');
            document.getElementById('error-text').textContent = message;
            element.style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
        }

        // API –∫—ñ–ª—Ç—ñ–Ω —Å–∞“õ—Ç–∞—É –∂”ô–Ω–µ —Ç–µ—Å—Ç—ñ–ª–µ—É
        async function saveAndTestAPIKey() {
            const key = document.getElementById('api-key-input').value.trim();
            
            if (!key) {
                showError('API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑');
                return;
            }
            
            if (!key.startsWith('sk-')) {
                showError('API –∫—ñ–ª—Ç—ñ "sk-" –¥–µ–ø –±–∞—Å—Ç–∞–ª—É—ã –∫–µ—Ä–µ–∫');
                return;
            }
            
            if (key.length < 40) {
                showError('API –∫—ñ–ª—Ç—ñ —Ç—ã–º “õ—ã—Å“õ–∞ (–∫–µ–º—ñ–Ω–¥–µ 40 —Å–∏–º–≤–æ–ª –±–æ–ª—É—ã –∫–µ—Ä–µ–∫)');
                return;
            }
            
            // –ö—ñ–ª—Ç—Ç—ñ —Å–∞“õ—Ç–∞—É
            OPENAI_API_KEY = key;
            localStorage.setItem('englishAI_openai_key', key);
            
            // –¢–µ—Å—Ç—ñ–ª–µ—É
            await testCurrentKey();
        }

        // –ê“ì—ã–º–¥–∞“ì—ã –∫—ñ–ª—Ç—Ç—ñ —Ç–µ—Å—Ç—ñ–ª–µ—É
        async function testCurrentKey() {
            if (!OPENAI_API_KEY) {
                showError('–ê–ª–¥—ã–º–µ–Ω API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑');
                return;
            }
            
            const testBtn = document.getElementById('save-test-btn');
            const originalText = testBtn.innerHTML;
            testBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –¢–µ—Å—Ç—ñ–ª–µ—É...';
            testBtn.disabled = true;
            
            try {
                const result = await testAPIKey(OPENAI_API_KEY);
                
                if (result.success) {
                    showSuccess('‚úÖ API –∫—ñ–ª—Ç—ñ –∂–∞—Ä–∞–º–¥—ã! –ë–æ—Ç “õ–∞–∑—ñ—Ä –∂“±–º—ã—Å —ñ—Å—Ç–µ–π –∞–ª–∞–¥—ã.');
                    updateAPIStatus();
                    enableInputs();
                    addMessage('‚úÖ API –∫—ñ–ª—Ç—ñ —Ç–µ—Å—Ç—ñ–ª–µ—É —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ! –ï–Ω–¥—ñ —Å“±—Ä–∞“õ “õ–æ—è –∞–ª–∞—Å—ã–∑.', 'bot');
                } else {
                    showError(`‚ùå API –∫—ñ–ª—Ç—ñ –∂–∞—Ä–∞–º—Å—ã–∑: ${result.error}`);
                    disableInputs();
                }
                
                // Debug –∞“õ–ø–∞—Ä–∞—Ç—ã–Ω –∫”©—Ä—Å–µ—Ç—É
                document.getElementById('debug-section').style.display = 'block';
                document.getElementById('debug-info').textContent = JSON.stringify(result, null, 2);
                
            } catch (error) {
                showError(`‚ùå –¢–µ—Å—Ç—ñ–ª–µ—É —Å”ô—Ç—Å—ñ–∑: ${error.message}`);
            } finally {
                testBtn.innerHTML = originalText;
                testBtn.disabled = false;
            }
        }

        // API –∫—ñ–ª—Ç—ñ–Ω —Ç–µ—Å—Ç—ñ–ª–µ—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
        async function testAPIKey(apiKey) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                role: "system",
                                content: "–¢–µ–∫ 'TEST SUCCESSFUL' –¥–µ–ø –∂–∞—É–∞–ø –±–µ—Ä."
                            },
                            {
                                role: "user", 
                                content: "Test"
                            }
                        ],
                        max_tokens: 10,
                        temperature: 0.1
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    return {
                        success: false,
                        error: data.error?.message || `HTTP ${response.status}`,
                        status: response.status,
                        data: data
                    };
                }

                return {
                    success: true,
                    message: 'API –∫—ñ–ª—Ç—ñ –∂–∞—Ä–∞–º–¥—ã',
                    data: data
                };

            } catch (error) {
                return {
                    success: false,
                    error: error.message,
                    status: 'NETWORK_ERROR'
                };
            }
        }

        // –ë–∞–π–ª–∞–Ω—ã—Å—Ç—ã —Ç–µ—Å—Ç—ñ–ª–µ—É
        async function testConnection(silent = false) {
            if (!OPENAI_API_KEY) {
                if (!silent) showError('–ê–ª–¥—ã–º–µ–Ω API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑');
                return;
            }

            if (!silent) {
                addMessage('üîå API –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω —Ç–µ—Å—Ç—ñ–ª–µ—É...', 'bot');
            }

            try {
                const result = await testAPIKey(OPENAI_API_KEY);
                
                if (result.success) {
                    if (!silent) {
                        addMessage('‚úÖ API –±–∞–π–ª–∞–Ω—ã—Å—ã —Å”ô—Ç—Ç—ñ –æ—Ä–Ω–∞—Ç—ã–ª–¥—ã! –ï–Ω–¥—ñ —Å“±—Ä–∞“õ “õ–æ—è –∞–ª–∞—Å—ã–∑.', 'bot');
                    }
                    updateAPIStatus();
                    enableInputs();
                } else {
                    if (!silent) {
                        addMessage(`‚ùå API –±–∞–π–ª–∞–Ω—ã—Å—ã —Å”ô—Ç—Å—ñ–∑: ${result.error}`, 'bot');
                    }
                    disableInputs();
                }
            } catch (error) {
                if (!silent) {
                    addMessage(`‚ùå –¢–µ—Å—Ç—ñ–ª–µ—É —Å”ô—Ç—Å—ñ–∑: ${error.message}`, 'bot');
                }
            }
        }

        function updateAPIStatus() {
            const statusElement = document.getElementById('api-status');
            if (OPENAI_API_KEY) {
                statusElement.style.display = 'block';
                statusElement.style.background = 'rgba(76, 175, 80, 0.2)';
                statusElement.style.color = '#2e7d32';
                statusElement.innerHTML = '<i class="fas fa-check-circle"></i> API –∫—ñ–ª—Ç—ñ —Å–∞“õ—Ç–∞–ª“ì–∞–Ω';
                botStatusText.textContent = 'AI –¥–∞–π—ã–Ω';
                botStatusText.style.color = 'var(--success)';
            } else {
                statusElement.style.display = 'block';
                statusElement.style.background = 'rgba(244, 67, 54, 0.2)';
                statusElement.style.color = '#c62828';
                statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> API –∫—ñ–ª—Ç—ñ –µ–Ω–≥—ñ–∑—ñ–ª–º–µ–≥–µ–Ω';
                botStatusText.textContent = 'API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑';
                botStatusText.style.color = 'var(--danger)';
            }
        }

        function enableInputs() {
            userInput.disabled = false;
            userInput.placeholder = "–ú”ô—Å–µ–ª–µ–Ω—ñ–∑–¥—ñ –æ—Å—ã –∂–µ—Ä–≥–µ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑...";
            sendBtn.disabled = false;
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.disabled = false;
            });
            document.querySelectorAll('.suggestion').forEach(suggestion => {
                suggestion.disabled = false;
            });
        }

        function disableInputs() {
            userInput.disabled = true;
            userInput.placeholder = "–ê–ª–¥—ã–º–µ–Ω API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑...";
            sendBtn.disabled = true;
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.disabled = true;
            });
            document.querySelectorAll('.suggestion').forEach(suggestion => {
                suggestion.disabled = true;
            });
        }

        // –ù–µ–≥—ñ–∑–≥—ñ OpenAI API —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
        async function getAIResponse(message) {
            if (!OPENAI_API_KEY) {
                return "”®—Ç—ñ–Ω–µ–º—ñ–Ω, –∞–ª–¥—ã–º–µ–Ω API –∫—ñ–ª—Ç—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑. “Æ—Å—Ç—ñ“£–≥—ñ –æ“£ –∂–∞“õ—Ç–∞“ì—ã 'API –ö—ñ–ª—Ç' —Ç“Ø–π–º–µ—Å—ñ–Ω –±–∞—Å—ã“£—ã–∑.";
            }

            // –ñ–∏—ñ–ª—ñ–∫ —à–µ–∫—Ç–µ—É—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
            const now = Date.now();
            const timeSinceLastCall = now - lastAPICallTime;
            
            if (timeSinceLastCall < MIN_TIME_BETWEEN_CALLS) {
                const waitTime = MIN_TIME_BETWEEN_CALLS - timeSinceLastCall;
                await new Promise(resolve => setTimeout(resolve, waitTime));
            }

            try {
                lastAPICallTime = Date.now();
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                role: "system",
                                content: `–°–µ–Ω EnglishAI –±–æ—Ç—Å—ã“£ - –∞“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ–Ω “Ø–π—Ä–µ—Ç–µ—Ç—ñ–Ω AI –∫”©–º–µ–∫—à—ñ—Å—ñ. 
                                        –°–µ–Ω “õ–∞–∑–∞“õ —Ç—ñ–ª—ñ–Ω–¥–µ –∂–∞—É–∞–ø –±–µ—Ä–µ—Å—ñ“£.
                                        –°–µ–Ω—ñ“£ –º–∞“õ—Å–∞—Ç—ã“£ - –∞“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ–Ω “Ø–π—Ä–µ–Ω—É–≥–µ –∫”©–º–µ–∫—Ç–µ—Å—É.
                                        –ñ–∞—É–∞–ø—Ç–∞—Ä—ã“£ –±—ñ–ª—ñ–º –±–µ—Ä–µ—Ç—ñ–Ω, –ø–∞–π–¥–∞–ª—ã –∂”ô–Ω–µ –¥–æ—Å—Ç—ã“õ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫.
                                        –ê“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ–Ω—ñ“£ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞—Å—ã–Ω, —Å”©–∑–¥—ñ–∫ “õ–æ—Ä—ã–Ω, —Å”©–π–ª–µ—É –¥–∞“ì–¥—ã–ª–∞—Ä—ã–Ω “Ø–π—Ä–µ—Ç.
                                        –ú—ã—Å–∞–ª–¥–∞—Ä –º–µ–Ω —Ç”ô–∂—ñ—Ä–∏–±–µ–ª–µ—Ä “±—Å—ã–Ω.
                                        –ñ–∞—É–∞–±—ã“£ “±–∑—ã–Ω–¥—ã“ì—ã 100-300 —Å”©–∑ –∞—Ä–∞–ª—ã“ì—ã–Ω–¥–∞ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫.`
                            },
                            {
                                role: "user",
                                content: message
                            }
                        ],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });

                if (response.status === 429) {
                    throw new Error('Rate limit exceeded. Please wait a moment before sending another message.');
                }

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API “õ–∞—Ç–µ—Å—ñ: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
                
            } catch (error) {
                console.error('API “õ–∞—Ç–µ—Å—ñ:', error);
                
                if (error.message.includes('Rate limit')) {
                    return `üòÖ –¢—ã–º –∂–∏—ñ —Å“±—Ä–∞—É –∂—ñ–±–µ—Ä—ñ–ø —Ç“±—Ä—Å—ã–∑! 10-30 —Å–µ–∫—É–Ω–¥ –∫“Ø—Ç—ñ–ø, “õ–∞–π—Ç–∞–ª–∞–ø –∫”©—Ä—ñ“£—ñ–∑.`;
                }
                
                if (error.message.includes('quota') || error.message.includes('billing')) {
                    return `üí≥ API –∫–≤–æ—Ç–∞—Å—ã –±—ñ—Ç–∫–µ–Ω —Å–∏—è“õ—Ç—ã. –¢”©–ª–µ–º –µ—Å–µ–±—ñ“£—ñ–∑–¥—ñ —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ –∂–∞“£–∞ API –∫—ñ–ª—Ç –∞–ª—ã“£—ã–∑.`;
                }
                
                if (error.message.includes('invalid_api_key')) {
                    return `üîë API –∫—ñ–ª—Ç—ñ –∂–∞—Ä–∞–º—Å—ã–∑. –ñ–∞“£–∞ –∫—ñ–ª—Ç –∞–ª—ã–ø, “õ–∞–π—Ç–∞ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.`;
                }
                
                return `–ö–µ—à—ñ—Ä—ñ“£—ñ–∑, “õ–∞–∑—ñ—Ä –∂–∞—É–∞–ø –±–µ—Ä–µ –∞–ª–º–∞–π–º—ã–Ω. “ö–∞—Ç–µ: ${error.message}`;
            }
        }

        // –•–∞–±–∞—Ä–ª–∞–º–∞–Ω—ã –∂—ñ–±–µ—Ä—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
        async function sendMessage() {
            const message = userInput.value.trim();
            if (message === '') return;
            
            addMessage(message, 'user');
            userInput.value = '';
            
            disableInputs();
            showTypingIndicator();
            
            try {
                const botResponse = await getAIResponse(message);
                hideTypingIndicator();
                addMessage(botResponse, 'bot');
                scrollToBottom();
            } catch (error) {
                hideTypingIndicator();
                addMessage("–ö–µ—à—ñ—Ä—ñ“£—ñ–∑, “õ–∞–∑—ñ—Ä –∂–∞—É–∞–ø –±–µ—Ä–µ –∞–ª–º–∞–π–º—ã–Ω. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.", 'bot');
                scrollToBottom();
            } finally {
                enableInputs();
            }
        }

        // –•–∞–±–∞—Ä–ª–∞–º–∞–Ω—ã “õ–æ—Å—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const messageContent = document.createElement('p');
            messageContent.textContent = text;
            messageDiv.appendChild(messageContent);
            
            // –£–∞“õ—ã—Ç—Ç—ã “õ–æ—Å—É
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            const now = new Date();
            timeDiv.textContent = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
            messageDiv.appendChild(timeDiv);
            
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        // –¢”©–º–µ–Ω–≥—ñ –∂–∞“õ“õ–∞ —Å–∫—Ä–æ–ª–¥–∞—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
        function scrollToBottom() {
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }

        // –ï–Ω–≥—ñ–∑—É –∫”©—Ä—Å–µ—Ç–∫—ñ—à—ñ–Ω –∫”©—Ä—Å–µ—Ç—É
        function showTypingIndicator() {
            typingIndicator.style.display = 'flex';
            scrollToBottom();
        }

        // –ï–Ω–≥—ñ–∑—É –∫”©—Ä—Å–µ—Ç–∫—ñ—à—ñ–Ω –∂–∞—Å—ã—Ä—É
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // –¢–µ–∑ ”ô—Ä–µ–∫–µ—Ç —Ç“Ø–π–º–µ–ª–µ—Ä—ñ
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (!this.disabled) {
                    userInput.value = this.getAttribute('data-message');
                    sendMessage();
                }
            });
        });

        // –•–∞–±–∞—Ä–ª–∞–º–∞–Ω—ã –∂—ñ–±–µ—Ä—É “Ø—à—ñ–Ω –æ“õ–∏“ì–∞–ª–∞—Ä
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !this.disabled) {
                sendMessage();
            }
        });

        // –ú–æ–¥–∞–ª—å–¥—ã —Ç–µ—Ä–µ–∑–µ–Ω—ñ –∂–∞–±—É
        document.getElementById('api-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideAPIKeyModal();
            }
        });
    </script>
</body>
</html>